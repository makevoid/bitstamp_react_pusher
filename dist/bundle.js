/* Generated by Opal 0.7.2 */
(function(Opal) {
  Opal.dynamic_require_severity = "error";
  var self = Opal.top, $scope = Opal, nil = Opal.nil, $breaker = Opal.breaker, $slice = Opal.slice, $module = Opal.module, $klass = Opal.klass, $hash2 = Opal.hash2, $gvars = Opal.gvars;
  if ($gvars.document == null) $gvars.document = nil;

  Opal.add_stubs(['$new', '$on', '$puts', '$==', '$select', '$>', '$map', '$to_f', '$empty?', '$bids=', '$sort_by', '$+', '$bids', '$asks=', '$asks', '$include', '$round', '$[]', '$params', '$div', '$after_mount', '$define_state', '$timer=', '$h3', '$p', '$present', '$each_with_index', '$render', '$create_element', '$to_n', '$body']);
  console.log("loading app environment");
  self.$require("browser");
  (function($base) {
    var self = $module($base, 'TxFetcher');

    var def = self.$$proto, $scope = self.$$scope;

    Opal.cdecl($scope, 'WS_ENDPOINT', "wss://ws.pusherapp.com/app/de504dc5763aeef9ff52?protocol=7&client=js&version=2.1.6&flash=false");

    Opal.defn(self, '$load_transactions', function() {
      var $a, $b, TMP_1, self = this, tx_viz = nil;

      tx_viz = self;
      return ($a = ($b = (($scope.get('Browser')).$$scope.get('Socket'))).$new, $a.$$p = (TMP_1 = function(){var self = TMP_1.$$s || this, $a, $b, TMP_2, $c, TMP_3;

      ($a = ($b = self).$on, $a.$$p = (TMP_2 = function(){var self = TMP_2.$$s || this;

        return self.$puts("{ \"event\": \"pusher:subscribe\", \"data\": { \"channel\": \"diff_order_book\" } }")}, TMP_2.$$s = self, TMP_2), $a).call($b, "open");
        return ($a = ($c = self).$on, $a.$$p = (TMP_3 = function(e){var self = TMP_3.$$s || this, $a, $b, TMP_4, $c, $d, TMP_5, TMP_6, $e, $f, TMP_7, $g, $h, TMP_8, $i, TMP_9, data = nil, bids = nil, asks = nil;
if (e == null) e = nil;
        data = JSON.parse(e.native.data);
          if ((data.event)['$==']("data")) {
            data = JSON.parse(data.data);
            bids = data.bids;
            asks = data.asks;
            bids = ($a = ($b = ($c = ($d = bids).$map, $c.$$p = (TMP_5 = function(price, volume){var self = TMP_5.$$s || this;
if (price == null) price = nil;if (volume == null) volume = nil;
            return [price.$to_f(), volume.$to_f()]}, TMP_5.$$s = self, TMP_5), $c).call($d)).$select, $a.$$p = (TMP_4 = function(price, volume){var self = TMP_4.$$s || this;
if (price == null) price = nil;if (volume == null) volume = nil;
            return volume['$>'](0)}, TMP_4.$$s = self, TMP_4), $a).call($b);
            asks = ($a = ($c = ($e = ($f = asks).$map, $e.$$p = (TMP_7 = function(price, volume){var self = TMP_7.$$s || this;
if (price == null) price = nil;if (volume == null) volume = nil;
            return [price.$to_f(), volume.$to_f()]}, TMP_7.$$s = self, TMP_7), $e).call($f)).$select, $a.$$p = (TMP_6 = function(price, volume){var self = TMP_6.$$s || this;
if (price == null) price = nil;if (volume == null) volume = nil;
            return volume['$>'](0)}, TMP_6.$$s = self, TMP_6), $a).call($c);
            if ((($a = bids['$empty?']()) !== nil && (!$a.$$is_boolean || $a == true))) {
              } else {
              (($a = [($g = ($h = (tx_viz.$bids()['$+'](bids))).$sort_by, $g.$$p = (TMP_8 = function(price, volume){var self = TMP_8.$$s || this;
if (price == null) price = nil;if (volume == null) volume = nil;
              return price}, TMP_8.$$s = self, TMP_8), $g).call($h)]), $e = tx_viz, $e['$bids='].apply($e, $a), $a[$a.length-1])
            };
            if ((($a = asks['$empty?']()) !== nil && (!$a.$$is_boolean || $a == true))) {
              return nil
              } else {
              return (($a = [($g = ($i = (tx_viz.$asks()['$+'](asks))).$sort_by, $g.$$p = (TMP_9 = function(price, volume){var self = TMP_9.$$s || this;
if (price == null) price = nil;if (volume == null) volume = nil;
              return price}, TMP_9.$$s = self, TMP_9), $g).call($i)]), $e = tx_viz, $e['$asks='].apply($e, $a), $a[$a.length-1])
            };
            } else {
            return nil
          };}, TMP_3.$$s = self, TMP_3), $a).call($c, "message");}, TMP_1.$$s = self, TMP_1), $a).call($b, $scope.get('WS_ENDPOINT'));
    });
  })(self);
  (function($base, $super) {
    function $Transaction(){};
    var self = $Transaction = $klass($base, $super, 'Transaction', $Transaction);

    var def = self.$$proto, $scope = self.$$scope;

    self.$include((($scope.get('React')).$$scope.get('Component')));

    return (def.$render = function() {
      var $a, $b, TMP_10, self = this, width = nil;

      width = self.$params()['$[]']("volume").$round(1);
      width = "" + (width) + "%";
      
      var divStyle = {
        width: width
      }
    ;
      return ($a = ($b = self).$div, $a.$$p = (TMP_10 = function(){var self = TMP_10.$$s || this;

      return "" + (self.$params()['$[]']("price")) + " USD - " + (self.$params()['$[]']("volume")) + " BTC"}, TMP_10.$$s = self, TMP_10), $a).call($b, $hash2(["style"], {"style": divStyle}));
    }, nil) && 'render';
  })(self, null);
  (function($base, $super) {
    function $TxViz(){};
    var self = $TxViz = $klass($base, $super, 'TxViz', $TxViz);

    var def = self.$$proto, $scope = self.$$scope, $a, $b, TMP_11, $c, TMP_12, $d, TMP_13;

    self.$include((($scope.get('React')).$$scope.get('Component')));

    self.$include($scope.get('TxFetcher'));

    self.$after_mount("load_transactions");

    self.$after_mount("reset_timer");

    ($a = ($b = self).$define_state, $a.$$p = (TMP_11 = function(){var self = TMP_11.$$s || this;

    return new Date();}, TMP_11.$$s = self, TMP_11), $a).call($b, "timer");

    ($a = ($c = self).$define_state, $a.$$p = (TMP_12 = function(){var self = TMP_12.$$s || this;

    return []}, TMP_12.$$s = self, TMP_12), $a).call($c, "bids");

    ($a = ($d = self).$define_state, $a.$$p = (TMP_13 = function(){var self = TMP_13.$$s || this;

    return []}, TMP_13.$$s = self, TMP_13), $a).call($d, "asks");

    def.$reset_timer = function() {
      var $a, $b, self = this;

      return (($a = [new Date()]), $b = self, $b['$timer='].apply($b, $a), $a[$a.length-1]);
    };

    return (def.$render = function() {
      var $a, $b, TMP_14, self = this;

      return ($a = ($b = self).$div, $a.$$p = (TMP_14 = function(){var self = TMP_14.$$s || this, $a, $b, TMP_15, $c, TMP_18, $d, TMP_26;

      ($a = ($b = self).$div, $a.$$p = (TMP_15 = function(){var self = TMP_15.$$s || this, $a, $b, TMP_16, $c, TMP_17;

        ($a = ($b = self).$h3, $a.$$p = (TMP_16 = function(){var self = TMP_16.$$s || this;

          return "Bitstamp Orderbook live trades"}, TMP_16.$$s = self, TMP_16), $a).call($b);
          return ($a = ($c = self).$p, $a.$$p = (TMP_17 = function(){var self = TMP_17.$$s || this;

          return "realtime orderbook trades visualizer, bitstamp - powered by opal, react, css3, websockets"}, TMP_17.$$s = self, TMP_17), $a).call($c, $hash2(["className"], {"className": "mini"}));}, TMP_15.$$s = self, TMP_15), $a).call($b, $hash2(["className"], {"className": "header"}));
        ($a = ($c = self).$div, $a.$$p = (TMP_18 = function(){var self = TMP_18.$$s || this, $a, $b, TMP_19;

        return ($a = ($b = self).$div, $a.$$p = (TMP_19 = function(){var self = TMP_19.$$s || this, $a, $b, TMP_20, $c, TMP_21, $d, TMP_22, $e, TMP_23, $f, TMP_24, $g, TMP_25;

          ($a = ($b = self).$p, $a.$$p = (TMP_20 = function(){var self = TMP_20.$$s || this;

            return "theme colors"}, TMP_20.$$s = self, TMP_20), $a).call($b);
            ($a = ($c = self).$p, $a.$$p = (TMP_21 = function(){var self = TMP_21.$$s || this;

            return "[  ] light"}, TMP_21.$$s = self, TMP_21), $a).call($c);
            ($a = ($d = self).$p, $a.$$p = (TMP_22 = function(){var self = TMP_22.$$s || this;

            return "[ x ] color"}, TMP_22.$$s = self, TMP_22), $a).call($d);
            ($a = ($e = self).$p, $a.$$p = (TMP_23 = function(){var self = TMP_23.$$s || this;

            return "[  ] dark"}, TMP_23.$$s = self, TMP_23), $a).call($e);
            ($a = ($f = self).$p, $a.$$p = (TMP_24 = function(){var self = TMP_24.$$s || this;

            return "[  ] desaturated"}, TMP_24.$$s = self, TMP_24), $a).call($f);
            return ($a = ($g = self).$p, $a.$$p = (TMP_25 = function(){var self = TMP_25.$$s || this;

            return "[  ] invert"}, TMP_25.$$s = self, TMP_25), $a).call($g);}, TMP_19.$$s = self, TMP_19), $a).call($b, $hash2(["className"], {"className": "theme colors"}))}, TMP_18.$$s = self, TMP_18), $a).call($c, $hash2(["className"], {"className": "right_panel"}));
        return ($a = ($d = self).$div, $a.$$p = (TMP_26 = function(){var self = TMP_26.$$s || this, $a, $b, TMP_27, $c, TMP_28, $d, TMP_29, $e, TMP_30;

        ($a = ($b = self).$h3, $a.$$p = (TMP_27 = function(){var self = TMP_27.$$s || this;

          return "Bids"}, TMP_27.$$s = self, TMP_27), $a).call($b);
          ($a = ($c = self.$bids().$each_with_index()).$map, $a.$$p = (TMP_28 = function(trade, idx){var self = TMP_28.$$s || this, $a, price = nil, volume = nil, comp = nil;
if (trade == null) trade = nil;if (idx == null) idx = nil;
          $a = Opal.to_ary(trade), price = ($a[0] == null ? nil : $a[0]), volume = ($a[1] == null ? nil : $a[1]);
            comp = self.$present($scope.get('Transaction'), $hash2(["price", "volume", "key"], {"price": price, "volume": volume, "key": "bid-" + (idx)}));
            return comp;}, TMP_28.$$s = self, TMP_28), $a).call($c);
          ($a = ($d = self).$h3, $a.$$p = (TMP_29 = function(){var self = TMP_29.$$s || this;

          return "Asks"}, TMP_29.$$s = self, TMP_29), $a).call($d);
          return ($a = ($e = self.$asks().$each_with_index()).$map, $a.$$p = (TMP_30 = function(trade, idx){var self = TMP_30.$$s || this, $a, price = nil, volume = nil, comp = nil;
if (trade == null) trade = nil;if (idx == null) idx = nil;
          $a = Opal.to_ary(trade), price = ($a[0] == null ? nil : $a[0]), volume = ($a[1] == null ? nil : $a[1]);
            comp = self.$present($scope.get('Transaction'), $hash2(["price", "volume", "key"], {"price": price, "volume": volume, "key": "ask-" + (idx)}));
            return comp;}, TMP_30.$$s = self, TMP_30), $a).call($e);}, TMP_26.$$s = self, TMP_26), $a).call($d, $hash2(["className"], {"className": "tx_list"}));}, TMP_14.$$s = self, TMP_14), $a).call($b);
    }, nil) && 'render';
  })(self, null);
  console.log("loading app.rb");
  return $scope.get('React').$render($scope.get('React').$create_element($scope.get('TxViz')), $gvars.document.$body().$to_n());
})(Opal);
